{
  "version": 3,
  "sources": ["../src/extension.ts", "../src/completionProvider.ts", "../src/debounce.ts", "../src/prompt.ts", "../src/ollamaClient.ts", "../src/utils.ts"],
  "sourcesContent": ["import * as vscode from \"vscode\";\r\nimport { InlineCompletionProvider } from \"./completionProvider\";\r\n\r\nexport function activate(context: vscode.ExtensionContext) {\r\n  console.log(\"\uD83C\uDFAF Extension activating...\");\r\n\r\n  // Check if inline suggestions are enabled\r\n  const config = vscode.workspace.getConfiguration('editor');\r\n  const inlineSuggestEnabled = config.get('inlineSuggest.enabled');\r\n  \r\n  console.log(\"\uD83D\uDCCB Inline suggest enabled:\", inlineSuggestEnabled);\r\n  \r\n  if (!inlineSuggestEnabled) {\r\n    vscode.window.showWarningMessage(\r\n      'Ollama Completions: Please enable \"editor.inlineSuggest.enabled\" in settings'\r\n    );\r\n  }\r\n\r\n  const provider = new InlineCompletionProvider();\r\n\r\n  // Register with broader selector - works for all files\r\n  const registration = vscode.languages.registerInlineCompletionItemProvider(\r\n    { pattern: \"**\" },  // Match all files instead of just { scheme: \"file\" }\r\n    provider\r\n  );\r\n\r\n  context.subscriptions.push(registration);\r\n\r\n  console.log(\"\u2705 Ollama Inline Completion activated\");\r\n  console.log(\"\uD83D\uDCDD Provider registered for all files\");\r\n\r\n  // Command to manually trigger (useful for testing)\r\n  const manualTriggerCommand = vscode.commands.registerCommand(\r\n    'ollama-completion.trigger',\r\n    async () => {\r\n      console.log(\"\uD83C\uDFAF Manual trigger requested\");\r\n      await vscode.commands.executeCommand('editor.action.inlineSuggest.trigger');\r\n    }\r\n  );\r\n\r\n  context.subscriptions.push(manualTriggerCommand);\r\n  \r\n  console.log(\"\uD83D\uDCDD Manual trigger command: ollama-completion.trigger\");\r\n}\r\n\r\nexport function deactivate() {\r\n  console.log(\"\uD83D\uDC4B Extension deactivating\");\r\n}", "import * as vscode from \"vscode\";\r\nimport { Debouncer } from \"./debounce\";\r\nimport { buildPrompt } from \"./prompt\";\r\nimport { generateCompletion } from \"./ollamaClient\";\r\nimport { cleanCompletion } from \"./utils\";\r\n\r\ninterface CompletionCache {\r\n  text: string;\r\n  line: number;\r\n  character: number;\r\n  uri: string;\r\n  timestamp: number;\r\n}\r\n\r\nexport class InlineCompletionProvider\r\n  implements vscode.InlineCompletionItemProvider {\r\n\r\n  private debouncer = new Debouncer(2000);\r\n  private cache: CompletionCache | null = null;\r\n  private isFetching = false;\r\n\r\n  constructor() {\r\n    console.log(\"\uD83D\uDE80 InlineCompletionProvider activated\");\r\n\r\n    vscode.workspace.onDidChangeTextDocument((e) => {\r\n      this.handleTextChange(e);\r\n    });\r\n  }\r\n\r\n  private handleTextChange(e: vscode.TextDocumentChangeEvent) {\r\n    const editor = vscode.window.activeTextEditor;\r\n    if (!editor) return;\r\n    if (editor.document.uri.toString() !== e.document.uri.toString()) return;\r\n\r\n    // If user typed something, invalidate cache if it doesn't match\r\n    // This prevents stale completions from showing after user keeps typing\r\n    if (this.cache && e.contentChanges.length > 0) {\r\n      const pos = editor.selection.active;\r\n      // If user is on a different line or moved far from cache position, clear cache\r\n      if (pos.line !== this.cache.line) {\r\n        this.cache = null;\r\n      }\r\n    }\r\n\r\n    const document = editor.document;\r\n    const position = editor.selection.active;\r\n\r\n    this.debouncer.run(async () => {\r\n      console.log(\"\u23F1\uFE0F User stopped typing for 2 seconds - fetching...\");\r\n      await this.fetchCompletion(document, position);\r\n    });\r\n  }\r\n\r\n  private async fetchCompletion(\r\n    document: vscode.TextDocument,\r\n    position: vscode.Position\r\n  ) {\r\n    if (this.isFetching) {\r\n      console.log(\"\u23F3 Already fetching\");\r\n      return;\r\n    }\r\n\r\n    const startLine = Math.max(0, position.line - 10);\r\n    const endLine = Math.min(document.lineCount, position.line + 5);\r\n\r\n    const prefix = document.getText(\r\n      new vscode.Range(startLine, 0, position.line, position.character)\r\n    );\r\n\r\n    const suffix = document.getText(\r\n      new vscode.Range(position.line, position.character, endLine, 0)\r\n    );\r\n\r\n    if (prefix.trim().length < 2) {\r\n      console.log(\"\u26A0\uFE0F Prefix too short\");\r\n      return;\r\n    }\r\n\r\n    const prompt = buildPrompt(document.languageId, prefix, suffix);\r\n\r\n    try {\r\n      this.isFetching = true;\r\n      console.log(\"\uD83C\uDF10 Calling Ollama...\");\r\n\r\n      const raw = await generateCompletion(prompt);\r\n      console.log(\"Raw response:\", JSON.stringify(raw.substring(0, 100)));\r\n\r\n      let completion = cleanCompletion(raw);\r\n\r\n      if (!completion) {\r\n        console.log(\"\u26A0\uFE0F Empty completion after cleanCompletion\");\r\n        this.isFetching = false;\r\n        return;\r\n      }\r\n\r\n      completion = this.cleanupCompletion(completion, document, position);\r\n\r\n      if (!completion) {\r\n        console.log(\"\u26A0\uFE0F Empty after cleanup\");\r\n        this.isFetching = false;\r\n        return;\r\n      }\r\n\r\n      // Only strip if the model echoed back a LONG chunk of what's already\r\n      // typed (e.g. it repeated the whole line). A minimum of 8 chars is\r\n      // required to avoid false positives like a single \"n\" or \"i\".\r\n      const currentLine = document.lineAt(position.line).text;\r\n      const textBeforeCursor = currentLine.substring(0, position.character);\r\n      const MIN_OVERLAP = 8;\r\n\r\n      if (textBeforeCursor.length >= MIN_OVERLAP) {\r\n        for (let i = Math.min(textBeforeCursor.length, completion.length); i >= MIN_OVERLAP; i--) {\r\n          const tail = textBeforeCursor.substring(textBeforeCursor.length - i);\r\n          if (completion.startsWith(tail)) {\r\n            completion = completion.substring(i);\r\n            console.log(`\u2702\uFE0F Stripped ${i} chars of echo: \"${tail}\"`);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!completion.trim()) {\r\n        console.log(\"\u26A0\uFE0F Empty after echo strip\");\r\n        this.isFetching = false;\r\n        return;\r\n      }\r\n\r\n      // Re-read the ACTUAL cursor position right now, not the stale one\r\n      // from when fetchCompletion() was first called. Ollama takes time,\r\n      // and the cursor may have drifted (e.g. auto-indent added a space).\r\n      const editor = vscode.window.activeTextEditor;\r\n      const actualPosition = editor ? editor.selection.active : position;\r\n\r\n      this.cache = {\r\n        text: completion,\r\n        line: actualPosition.line,\r\n        character: actualPosition.character,\r\n        uri: document.uri.toString(),\r\n        timestamp: Date.now()\r\n      };\r\n\r\n      console.log(\"\u2705 Cached at L\" + actualPosition.line + \":\" + actualPosition.character);\r\n      console.log(\"\uD83D\uDCDD Cached text:\", JSON.stringify(completion.substring(0, 60)));\r\n\r\n      this.isFetching = false;\r\n\r\n      // Trigger inline suggest ONLY \u2014 do NOT trigger the dropdown suggest\r\n      await this.showCompletion();\r\n\r\n    } catch (err) {\r\n      console.error(\"\u274C Error:\", err);\r\n      this.cache = null;\r\n      this.isFetching = false;\r\n    }\r\n  }\r\n\r\n  private async showCompletion() {\r\n    console.log(\"\uD83C\uDFAF Triggering inline suggest...\");\r\n\r\n    try {\r\n      // ONLY use inlineSuggest.trigger \u2014 NEVER use editor.action.triggerSuggest\r\n      // triggerSuggest opens the DROPDOWN autocomplete popup which immediately\r\n      // dismisses/conflicts with inline ghost text.\r\n      await vscode.commands.executeCommand(\"editor.action.inlineSuggest.trigger\");\r\n      console.log(\"\u2705 Triggered inline suggest\");\r\n    } catch (err) {\r\n      console.error(\"\u274C Failed to trigger inline suggest:\", err);\r\n    }\r\n  }\r\n\r\n  private cleanupCompletion(\r\n    completion: string,\r\n    document: vscode.TextDocument,\r\n    position: vscode.Position\r\n  ): string {\r\n    // FIRST: normalize line endings. Ollama on Windows returns \\r\\n,\r\n    // which breaks every split/trim/startsWith check downstream.\r\n    completion = completion.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\r\n\r\n    // Strip markdown code fences\r\n    completion = completion\r\n      .replace(/^```[\\w]*\\n?/g, \"\")\r\n      .replace(/\\n?```$/g, \"\")\r\n      .trim();\r\n\r\n    // Strip a leading function/class/method signature ONLY if the model echoed\r\n    // back something the user already typed. If the cursor is on a blank line or\r\n    // a comment, the signature IS the desired completion \u2014 keep it.\r\n    const lang = document.languageId;\r\n    const cursorLine = document.lineAt(position.line).text.trim();\r\n    const cursorIsBlankOrComment =\r\n      cursorLine === \"\" ||\r\n      cursorLine.startsWith(\"//\") ||\r\n      cursorLine.startsWith(\"#\") ||\r\n      cursorLine.startsWith(\"/*\") ||\r\n      cursorLine.startsWith(\"*\");\r\n\r\n    // Also check the line BEFORE the cursor for context\r\n    const prevLineText = position.line > 0\r\n      ? document.lineAt(position.line - 1).text.trim()\r\n      : \"\";\r\n    const prevIsBlankOrComment =\r\n      prevLineText === \"\" ||\r\n      prevLineText.startsWith(\"//\") ||\r\n      prevLineText.startsWith(\"#\") ||\r\n      prevLineText.startsWith(\"/*\") ||\r\n      prevLineText.startsWith(\"*\");\r\n\r\n    // Only attempt signature stripping if the cursor line actually has code\r\n    // (not just a comment or blank) \u2014 meaning the user may have partially typed it.\r\n    if (!cursorIsBlankOrComment) {\r\n      if (lang === \"python\") {\r\n        completion = completion.replace(/^(def|class)\\s+\\w+[^:]*:\\s*\\n/s, \"\");\r\n      } else if (lang === \"javascript\" || lang === \"typescript\") {\r\n        completion = completion.replace(/^(export\\s+)?(default\\s+)?(async\\s+)?(function\\s*\\*?\\s+\\w+|const|let|var)\\s+[^\\n]*\\n/s, \"\");\r\n      } else if (lang === \"cpp\" || lang === \"c\" || lang === \"java\" || lang === \"csharp\") {\r\n        completion = completion.replace(\r\n          /^(template\\s*<[^>]*>\\s*\\n)?(public|private|protected|static|virtual|override|inline|extern|const|constexpr|friend|explicit|noexcept|\\s)*[\\w:<>\\[\\]\\*&\\s]+\\w+\\s*\\([^)]*\\)\\s*(const\\s*)?(override\\s*)?(\\{|->[\\w:<>\\[\\]\\*&\\s]+\\{)\\s*\\n?/s,\r\n          \"\"\r\n        );\r\n      }\r\n    }\r\n\r\n    const currentLine = document.lineAt(position.line).text;\r\n    const textAfterCursor = currentLine.substring(position.character).trim();\r\n\r\n    // If completion starts with text that already exists after cursor, strip it\r\n    if (textAfterCursor && completion.trimStart().startsWith(textAfterCursor)) {\r\n      completion = completion.trimStart().substring(textAfterCursor.length);\r\n    }\r\n\r\n    if (!completion.trim()) return \"\";\r\n\r\n    // --- Re-indent multi-line completions properly ---\r\n    // The model returns code with its OWN indentation (often starting at col 0\r\n    // or at some arbitrary level). We REBASE it so line 1 has no extra indent\r\n    // (it continues at the cursor), and all subsequent lines are indented\r\n    // relative to the current line's indent, preserving the model's own\r\n    // relative nesting structure.\r\n    const lines = completion.split('\\n');\r\n\r\n    // Detect the model's own base indent from its first non-empty line\r\n    let modelBaseIndent = \"\";\r\n    for (const line of lines) {\r\n      if (line.trim().length > 0) {\r\n        modelBaseIndent = line.match(/^(\\s*)/)?.[1] || \"\";\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Target indent = the indentation of the current editor line\r\n    const targetIndent = currentLine.match(/^(\\s*)/)?.[1] || \"\";\r\n\r\n    const rebased = lines.map((line, idx) => {\r\n      if (line.trim() === \"\") return \"\";  // empty lines stay empty\r\n\r\n      // Strip the model's base indent to get the line's RELATIVE indent\r\n      let stripped = line;\r\n      if (line.startsWith(modelBaseIndent)) {\r\n        stripped = line.substring(modelBaseIndent.length);\r\n      }\r\n\r\n      if (idx === 0) {\r\n        // First line continues at the cursor \u2014 no indent prefix needed\r\n        return stripped.trimStart();\r\n      }\r\n\r\n      // All other lines: targetIndent + the relative indent the model used\r\n      return targetIndent + stripped;\r\n    });\r\n\r\n    return rebased.join('\\n');\r\n  }\r\n\r\n  provideInlineCompletionItems(\r\n    document: vscode.TextDocument,\r\n    position: vscode.Position,\r\n    context: vscode.InlineCompletionContext,\r\n    token: vscode.CancellationToken\r\n  ): vscode.ProviderResult<vscode.InlineCompletionItem[] | vscode.InlineCompletionList> {\r\n\r\n    console.log(\"\uD83D\uDD0D PROVIDER CALLED | L\" + position.line + \":\" + position.character +\r\n      \" | cache:\", !!this.cache + \" | triggerKind:\", context.triggerKind);\r\n\r\n    if (!this.cache) {\r\n      console.log(\"\u274C No cache\");\r\n      return [];\r\n    }\r\n\r\n    // Cache TTL: 10 seconds\r\n    const age = Date.now() - this.cache.timestamp;\r\n    if (age > 10000) {\r\n      console.log(\"\u274C Cache expired (\" + age + \"ms)\");\r\n      this.cache = null;\r\n      return [];\r\n    }\r\n\r\n    if (this.cache.uri !== document.uri.toString()) {\r\n      console.log(\"\u274C Wrong document\");\r\n      this.cache = null;\r\n      return [];\r\n    }\r\n\r\n    // Must be on the same line where cache was created\r\n    if (this.cache.line !== position.line) {\r\n      console.log(\"\u274C Different line (cache:\" + this.cache.line + \" pos:\" + position.line + \")\");\r\n      this.cache = null;\r\n      return [];\r\n    }\r\n\r\n    const charDiff = position.character - this.cache.character;\r\n\r\n    // If cursor moved BACKWARDS, cache is invalid\r\n    if (charDiff < 0) {\r\n      console.log(\"\u274C Cursor moved back\");\r\n      this.cache = null;\r\n      return [];\r\n    }\r\n\r\n    // If cursor moved too far forward, cache is stale\r\n    if (charDiff > this.cache.text.length) {\r\n      console.log(\"\u274C Cursor moved beyond completion length\");\r\n      this.cache = null;\r\n      return [];\r\n    }\r\n\r\n    let completionText = this.cache.text;\r\n\r\n    // If user typed some characters since cache was set,\r\n    // check that what they typed matches the start of our completion,\r\n    // then serve only the remaining part.\r\n    if (charDiff > 0) {\r\n      const currentLine = document.lineAt(position.line).text;\r\n      const typed = currentLine.substring(this.cache.character, position.character);\r\n\r\n      if (completionText.startsWith(typed)) {\r\n        // User typed exactly what we predicted \u2014 serve the rest\r\n        completionText = completionText.substring(typed.length);\r\n        console.log(\"\u2702\uFE0F User typed \" + charDiff + \" chars that matched, serving rest\");\r\n      } else if (charDiff <= 2 && typed.trim() === \"\") {\r\n        // Cursor drifted by 1-2 whitespace chars (e.g. auto-indent or\r\n        // the inlineSuggest.trigger command shifting the cursor).\r\n        // Ignore the drift and serve the full completion as-is.\r\n        console.log(\"\u26A0\uFE0F Ignoring whitespace drift of \" + charDiff + \" chars\");\r\n      } else {\r\n        // What user typed doesn't match our completion \u2192 invalidate\r\n        console.log(\"\u274C Typed text doesn't match. typed='\" + typed + \"' completion starts with '\" + completionText.substring(0, typed.length) + \"'\");\r\n        this.cache = null;\r\n        return [];\r\n      }\r\n    }\r\n\r\n    if (!completionText) {\r\n      console.log(\"\u274C Nothing left to show\");\r\n      this.cache = null;\r\n      return [];\r\n    }\r\n\r\n    console.log(\"\u2705 RETURNING completion:\", JSON.stringify(completionText.substring(0, 60)));\r\n\r\n    const item = new vscode.InlineCompletionItem(\r\n      completionText,\r\n      new vscode.Range(position, position)\r\n    );\r\n\r\n    return [item];\r\n  }\r\n}", "/**\r\n * Debouncer - delays function execution until user stops triggering\r\n * Perfect for \"wait 2 seconds after user stops typing\" behavior\r\n */\r\nexport class Debouncer {\r\n  private timer?: NodeJS.Timeout;\r\n\r\n  constructor(private delay: number = 250) {}\r\n\r\n  /**\r\n   * Run function after delay. Cancels any previous pending execution.\r\n   * @param fn Function to run after delay\r\n   */\r\n  run(fn: () => void | Promise<void>) {\r\n    // Cancel previous timer if it exists\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n    }\r\n\r\n    // Start new timer\r\n    this.timer = setTimeout(() => {\r\n      fn();\r\n      this.timer = undefined;\r\n    }, this.delay);\r\n  }\r\n\r\n  /**\r\n   * Cancel any pending execution\r\n   */\r\n  cancel() {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n      this.timer = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if there's a pending execution\r\n   */\r\n  isPending(): boolean {\r\n    return this.timer !== undefined;\r\n  }\r\n}", "/**\r\n * Alternative prompt strategies for Qwen2.5-Coder\r\n * Try these in order until one works\r\n */\r\n\r\n// OPTION 1: Simple prefix-only (RECOMMENDED - Most reliable)\r\nexport function buildPrompt(\r\n  language: string,\r\n  prefix: string,\r\n  suffix: string\r\n) {\r\n  // Just send the code - let model continue naturally\r\n  // This works best when model keeps trying to chat\r\n  return prefix;\r\n}\r\n\r\n// OPTION 2: FIM with explicit instruction (if Option 1 doesn't work)\r\n/*\r\nexport function buildPrompt(\r\n  language: string,\r\n  prefix: string,\r\n  suffix: string\r\n) {\r\n  return `<|fim_prefix|>${prefix}<|fim_suffix|>${suffix}<|fim_middle|>`;\r\n}\r\n*/\r\n\r\n// OPTION 3: Minimal instruction (if model needs guidance)\r\n/*\r\nexport function buildPrompt(\r\n  language: string,\r\n  prefix: string,\r\n  suffix: string\r\n) {\r\n  return `${prefix}`;\r\n}\r\n*/", "export async function generateCompletion(prompt: string) {\r\n  const res = await fetch(\"http://localhost:11434/api/generate\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({\r\n      model: \"qwen2.5-coder:1.5b\",\r\n      prompt,\r\n      stream: false,\r\n      raw: true,  // Bypass chat template\r\n      \r\n      options: {\r\n        temperature: 0.2,\r\n        num_predict: 150,        // Longer to get full function\r\n        repeat_penalty: 1.1,\r\n        \r\n        // CRITICAL: Stop before test code\r\n        stop: [\r\n          \"\\n# Test\",           // \"# Test the function\"\r\n          \"\\nprint(\",           // Test print statements\r\n          \"\\n# Example\",        // Example comments\r\n          \"\\nif __name__\",      // Main block\r\n          \"\\n\\ndef \",           // Next function definition\r\n          \"\\n\\nclass \",         // Next class definition\r\n          \"\\n\\n\\n\",             // Triple newline\r\n        ]\r\n      }\r\n    })\r\n  });\r\n\r\n  const json = await res.json();\r\n  return json.response ?? \"\";\r\n}", "/**\r\n * Clean and extract only the relevant code completion.\r\n * Removes test code, comments, and extra content.\r\n * Language-agnostic: works for Python, JS/TS, C++, Java, C#, etc.\r\n */\r\nexport function cleanCompletion(text: string): string {\r\n  if (!text) return \"\";\r\n\r\n  let cleaned = text;\r\n\r\n  // \u2500\u2500\u2500 FIRST: normalize line endings (Ollama on Windows returns \\r\\n) \u2500\u2500\u2500\r\n  cleaned = cleaned.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\r\n\r\n  // Step 1: Remove markdown code blocks\r\n  cleaned = cleaned\r\n    .replace(/^```[\\w]*\\n?/g, \"\")\r\n    .replace(/\\n?```$/g, \"\")\r\n    .replace(/```/g, \"\");\r\n\r\n  // Step 2: Remove conversational prefixes the model sometimes emits\r\n  const conversationalPrefixes = [\r\n    /^(Sure|Certainly|Here'?s?|Below is|This is|The code|I'll|Let me).*?\\n/i,\r\n    /^.*?:\\s*\\n/,  // Lines ending with colon that look like explanations\r\n  ];\r\n\r\n  for (const pattern of conversationalPrefixes) {\r\n    cleaned = cleaned.replace(pattern, \"\");\r\n  }\r\n\r\n  // Step 3: Split into lines and stop at test/example code markers.\r\n  // These markers are language-agnostic \u2014 covers Python, C-style comments, etc.\r\n  const lines = cleaned.split('\\n');\r\n  const resultLines: string[] = [];\r\n\r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n\r\n    // \u2500\u2500 Python-style test markers \u2500\u2500\r\n    // \"# Test ...\", \"# Example ...\", \"# Output ...\"\r\n    if (trimmed.startsWith('#') &&\r\n        (trimmed.includes('Test') || trimmed.includes('Example') || trimmed.includes('Output'))) {\r\n      break;\r\n    }\r\n    // Python print statements (almost always test code at the end)\r\n    if (trimmed.startsWith('print(')) break;\r\n    // Python main guard\r\n    if (trimmed.includes('__name__') && trimmed.includes('__main__')) break;\r\n\r\n    // \u2500\u2500 C-style test markers (C++, Java, C#, JS/TS) \u2500\u2500\r\n    // \"// Test ...\", \"// Example ...\", \"/* Test ... */\"\r\n    if (/^\\/\\/\\s*(Test|Example|Output|Usage|Main)/i.test(trimmed)) break;\r\n    if (/^\\/\\*\\s*(Test|Example|Output|Usage|Main)/i.test(trimmed)) break;\r\n\r\n    // \"int main(\" or \"public static void main(\" \u2014 stop before main()\r\n    if (/^(public\\s+static\\s+)?(void\\s+)?main\\s*\\(/.test(trimmed)) break;\r\n\r\n    // Java/C# test class or method annotations\r\n    if (trimmed === \"@Test\" || trimmed.startsWith(\"@Test(\")) break;\r\n\r\n    // C++ / Java standalone test calls like \"cout <<\", \"System.out.println\"\r\n    if (trimmed.startsWith('cout <<') || trimmed.startsWith('System.out.println')) break;\r\n\r\n    // \u2500\u2500 Prose / natural-language explanation leak \u2500\u2500\r\n    // The model sometimes appends English sentences after the code, e.g.\r\n    // \"This code defines a `StringChecker` class with methods to check...\"\r\n    // These have no code-syntax characters and start with a capital letter.\r\n    // Only check AFTER we already have some code lines (don't trigger on line 1).\r\n    if (resultLines.length > 0 && trimmed.length > 20) {\r\n      const hasSyntax = /[;{}()\\[\\]=<>]/.test(trimmed);\r\n      const startsWithCapital = /^[A-Z]/.test(trimmed);\r\n      const looksLikeProse = startsWithCapital && !hasSyntax;\r\n      if (looksLikeProse) {\r\n        console.log(\"\uD83D\uDEAB Stopped at prose line: \" + trimmed.substring(0, 40));\r\n        break;\r\n      }\r\n    }\r\n\r\n    resultLines.push(line);\r\n  }\r\n\r\n  cleaned = resultLines.join('\\n').trimEnd();\r\n\r\n  // Step 4: Remove trailing comment-only lines\r\n  // Works for both # (Python) and // (C-style) comments\r\n  const finalLines = cleaned.split('\\n');\r\n  const codeLines: string[] = [];\r\n\r\n  for (const line of finalLines) {\r\n    const trimmed = line.trim();\r\n\r\n    // If we already have code and hit a trailing comment block, stop\r\n    if (codeLines.length > 0) {\r\n      const lastCodeLine = codeLines[codeLines.length - 1].trim();\r\n      const isComment = trimmed.startsWith('#') || trimmed.startsWith('//') || trimmed.startsWith('/*');\r\n      const lastWasCode = lastCodeLine && !lastCodeLine.startsWith('#') && !lastCodeLine.startsWith('//');\r\n\r\n      if (isComment && lastWasCode) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    codeLines.push(line);\r\n  }\r\n\r\n  return codeLines.join('\\n').trimEnd();\r\n}"],
  "mappings": "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",
  "names": ["vscode"]
}
